\section{Event Detector}
\label{sec-detector}

The inputs to PocketParker's availability estimation algorithm are arrival
and departure events generated by an activity detector running unattended in
each users pocket. While a great deal of previous research has explored
activity detection using sensor on mobile devices~\cite{FIXME}, we designed a
simple custom parking event detector tailored to the goals of PocketParker.
In addition to being designed and tuned to the specifics of our detection
problem, our event detector can also utilize the structure of our monitoring
problem to reduce false positives. In this section, we describe our event
detector and the portions of the PocketParker system that run on the
smartphone itself.

\subsection{Parking Events}
\label{subsec-goals}

PocketParker assumes that transitions between walking and driving that occur
in locations known to be parking lots constitute either arrival (driving to
walking) or departure (walking to driving) events. Thus, we must be able to
efficiently detect walking and driving activities, and detect transitions
fast enough to determine the location of the parking lot in which the event
took place. While all these states could be detected using
continuously-sampled GPS data, this would consume too much energy to be an
effective pocketsourcing solution.

Instead, we rely on duty-cycled accelerometer data to classify the user into
one of three states: walking, driving, or idle.

The application needs to determine the state of the user---whether walking,
driving or idle---and needs to be simple, quick and reasonably effective
for our goals. We rely solely on accelerometer data for an initial
determination of state, as continuously cycled GPS sensing would consume too
much power. An accelerometer :15 duty cycle, with :05 sensing and :10 idle
periods, proved an optimal. Five seconds was the minimum time necessary to
detect sensing activity accurately. We also wanted to obtain two sensing
periods within a short period of time for confirmation.

%The initial test for user state is based on the standard deviation of high
%amplitude waves, corresponding approximately to user gait, within a sensing
%period. A standard deviation of less than .15 m/s^2 implies a user state of
%idle, a measurement above .50 m/s^2 to that of walking, and values in between
%to driving. The application stores a history of user states for future
%reference. From this history, we define the user steady state to be whatever
%state, if any, constitutes a majority of the individual states observed
%within the last nine periods.

We use user state, in turn, to determine parking arrival and departure
events. The program determines that a parking event has transpired when
three conditions are satisfied. The user steady state must be driving, and
the last individual state observed must be walking. Further, the frequency
of high amplitude peaks in the last sample must correspond to that of mean
human gait. This test catches the large majority of parking events, where
people park their cars and immediately begin walking. However, drivers
occasionally sit in their cars for a period before leaving. To catch this
type of parking event, the program employs a second test. It also concludes
that a driver has parked when the user steady state transcends from driving
to idle to walking within a three-minute period.

When the program concludes that a user has parked, it turns on GPS detection
long enough to determine the walking velocity and bearing of the user. It
then calculates backwards to estimate the location where the user started
walking---that is, to the parking spot.

Steady State â€“ majority of the nine most recent states...

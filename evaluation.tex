\begin{figure*}[t]
\centering
\includegraphics[width=\textwidth]{./simulator/figures/lots.pdf}

\caption{\textbf{Description of each type of lot simulated.} Five different
lots with different behaviors were used during simulations.}

\label{fig-lotsdescription}
\end{figure*}

\section{Evaluation}
\label{sec-evaluation}

We evaluate PocketParker in three ways. First, we conducted a controlled
experiment to determine the best parameter settings for our event detector.
Second, we implemented a parking lot simulator to experiment with various
kinds of lots and vary the monitored fraction and other parameters. Finally,
we performed a large-scale deployment of PocketParker on our campus and use
it to monitor two lots. Camera monitoring was used to ground truth the
predictions from our deployment dataset. Our evaluations confirm that
PocketParker is efficient and accurate.

\subsection{Detector Experiment}

\begin{figure}[t]
\centering
\includegraphics[width=3.325in]{./figures/Energy_accuracy.pdf}

\caption{\textbf{Power usage vs. detector accuracy.} Energy usage by
PocketParker is low at all duty cycles, so we chose a high duty cycle in
order to improve detection accuracy.}

\label{fig-energy}
\end{figure}

\input{./figures/experiment_table/table.tex}

To determine the right parameter settings for our transition detector, we
conducted a controlled experiment. During this experiment, accelerometer and
GPS data was collected and stored continuously on each device, and
participants were asked to manually label each transition into and out of the
car. Afterwards, data was processed by a Python simulator implementing the
identical algorithm used by the PocketParker application, allowing us measure
accuracy and energy consumption as a function of the detector duty cycle.

Eight volunteers participated, including seven men and one woman. Seven were
right-handed and one was left-handed. Each was asked to conduct the same
experiment ten times: (1) carrying the instrumented phone, walk to their car;
(2) label departure; (3) drive around campus briefly; (4) park and label
arrival; (5) return inside. Since the way the phone is carried while walking
and placed in the car while driving affects the accelerometer readings, care
was taken to generate a good mix of carry and car location styles.
Table~\ref{table-experiment} shows the breakdown. The experiment permitted us
to obtain sensing data from a cross section of individuals possessing
different body morphologies, habits of driving cars, and ways of handling
mobile devices. Participation in the experiment took roughly one hour and
pizza was provided.

Figure~\ref{fig-energy} displays the tradeoff between energy usage and
detection accuracy as a function of the PocketParker duty cycle. Here we
combine an active period of 5s with a inactive period of variable length,
between 5~and~55s, for an overall duty cycle between 0.5 and 0.06. Our
simulator uses energy numbers used by the Android Fuel Gauge application
along with the accelerometer duty cycles and number of GPS locations
requested including false positives to estimate average power consumption.
This graph measures the accuracy of detected events in terms of distance from
the actual location of the event labeled by the participant.

As we expect, longer duty cycles consume less energy but produce longer
detection latencies which translate into higher distances from the event
location. Note also that the departure events have higher location error than
the parking events, because departing users are driving and therefore
traveling more rapidly. Overall power usage by PocketParker is low, under
10~mW at all duty cycles. Because PocketParker's ability to map parking
events into lots is affected by the detection distance accuracy, we chose a
low total period of 15~s for a 0.25 duty cycle. This allows PocketParker to
determine location to within 25~m for arrival events and 80~m for departures.
Power consumption at this duty cycle is 8~mW, representing 4.2\% of the
capacity of a 1500~mAh battery over 24~hours of usage.

\begin{figure}
\centering
\includegraphics[width=3.325in]{./figures/Rate_FP_and_ND.pdf}

\caption{\textbf{False positive and negative rates as a function of detector
duty cycle.}} 

\label{fig-falsepositives}
\end{figure}

Using the same data we also examine the false positive and negative rates for
arrivals and departures. This is important since, without explicit user
input, it would be impossible to determine this information while
PocketParker is in use. Figure~\ref{fig-falsepositives} shows PocketParker
can detect 80\% of arrival and departure events correctly at the 0.25 duty
cycle we use. False positive rates are already quite low, and this is before
we apply our GPS availability filter and lot location filters. False
positives decline as the duty cycle decreases because PocketParker has fewer
opportunities to detect user activity.

\begin{figure}[t]
\centering
\includegraphics[width=3.325in]{./figures/MissedEvents_CDF.pdf}

\caption{\textbf{The percentage of missed parking Events.}}

\label{fig-missedevents}
\end{figure}

Also, Figure~\ref{fig-missedevents} shows that PocketParker detects parking
events faithfully. As the graph indicates, 80\% users of PocketParker missed 
below 25\% parking events throughout the whole deployment period. The reason
behind the missed 25\% parking events is that PocketParker has transition 
time threshold as 5 minutes. Therefore, if an user transits transits from 
walking to driving or driving to walking in 5 minutes, PocketParker does 
not detect them.

\subsection{Simulation Results}
\label{subsec-simulator}

To experiment with PocketParker in a more controlled setting, we implemented
a parking lot simulator in Python. Our simulator allows us to simulate any
number of parking lots associated with any number of points of interest with
varying desirability levels. For simplicity during our evaluation, we
simulate two lots 1~and~2 with lot~1 filling before lot~2, although lot
choice by simulated drivers is randomly weighted. Particularly for evaluating
our monitored fraction estimation, we use five types of lots that fill and
empty differently:

\begin{itemize}

\item \textbf{Fast Fill} and \textbf{Slow Fill} fill once per day quickly or
slowly, like a lot associated with a place of work.

\item \textbf{High Churn} starts with lot~1 full and experiences continuously
high arrival and departures rates, like an airport parking lot.

\item \textbf{Low Churn} represents underutilized lots that never completely
fill, with lot~2 almost completely unused.

\item \textbf{Multiple Fill} represents a lot that rapidly fills and empties
repeatedly during each day, like a campus lot or movie theater.

\end{itemize}

Figure~\ref{fig-lotsdescription} shows the arrival and departure rates for
each of the types of lot as well as the resulting per-lot capacity.

\begin{figure*}
\centering
\includegraphics[width=\textwidth]{./simulator/figures/capacity_experiment.pdf}

\caption{\textbf{Errors in monitored fraction estimation.} Currently
PocketParker is better at estimating the monitored fraction when lots fill
and empty regularly.}

\label{fig-capacityerrors}
\end{figure*}

\subsubsection{Monitored fraction estimation}

In Section~\ref{subsubsec-monitored} we describe our approach to estimated
the monitored fraction, a parameter important to the operation of the
PocketParker availability estimator. Figure~\ref{fig-capacityerrors} shows
the results of 10 random simulations for each lot type. In each case, the
monitored fraction estimator uses a weeks worth of data and proceeds as
described previously. The error in the monitored fraction estimate is shown
as a function of the actual monitored fraction for the simulation used.

For the five types of lots, we would expect PocketParker to do better
monitored fraction estimation when lots fill regularly---Fast Fill, Slow
Fill, and Multiple Fill---and poorly when they do fill erratically or not at
all---High and Low Churn. The results in Figure~\ref{fig-capacityerrors}
generally follow this pattern. Errors for High Churn are quite high, and Low
Churn errors persist even at high monitored driver fractions. This is
natural, as the Low Churn lot never fills. Fast Fill results improve with
increasing monitored driver fraction. We are investigating, however, the
problems with estimating lot~1 capacity, and persistent errors with the Slow
Fill lots. Improving the accuracy of monitored fraction estimation may
require additional smoothing techniques or merging information from multiple
related lots. However, as we demonstrate later, our availability estimator is
robust to monitored fraction estimation errors up to 50\%.

\begin{figure}[t]
\centering
\includegraphics[width=3.325in]{./simulator/figures/tracking_fastfill.pdf}

\caption{\textbf{Availability probabilities tracking lot capacity.} Dips in
the availability probability correspond to times when PocketParker believes
the lot is full. Discontinuities are caused by departures, which set the
instantaneous probability that the lot is available to 1.0.}

\label{fig-trackingexample}
\end{figure}

\subsubsection{Probability and availability}

At this point we take a closer look at the way that PocketParker adjusts lot
availability probabilities. Keep in mind that the absolute value of the
availability probability for each lot may not meaningful. Instead,
PocketParker uses the probabilities to order available lots in response to
queries. We examine its accuracy at performing this essential task next.
However, it is illustrative to examine the probabilities PocketParker
maintains and observe how they vary as the number of available spots in the
lot changes.

Figure~\ref{fig-trackingexample} shows a 24~hour simulation of a Fast Fill
parking lot with a monitored fraction of 0.1 and a 10\% error in the
estimation of the monitored fraction. The ground truth capacity of the lot as
simulated is plotted next to the PocketParker probability that the lot has an
available spot. At the beginning of the simulation, both lots are marked as
free. When lot~1 fills and lot~2 begins to fill, generating implicit searches
in lot~1, the availability probability of lot~1 drops. It spikes upward
repeatedly due to departures from lot~1---which reset the short-term
probability of an available spot back to 1---but does not equal the
probability for lot~2 again until the point when the departure rate for lot~1
climbs.

\subsubsection{Prediction accuracy}

\input{./simulator/figures/accuracy_table.tex}

\begin{figure}[t]
\centering
\includegraphics[width=3.325in]{./simulator/figures/accuracy_graph.pdf}

\caption{\textbf{Accuracy predictions for various kind of lots and fms.} }
\label{fig-accuracy}
\end{figure}

PocketParker exists to help drivers choose parking lots. Here, we examine our
simulation results and determine whether we accomplish this goal. In our
simulations, we inject regular queries to PocketParker asking it to order the
two available lots. We categorize its response as either a correct
prediction, a missed opportunity, or a waste of time. A missed opportunity
represents a case where a more desirable lot was available than the one that
PocketParker recommended. A waste of time indicates that PocketParker sent
the user to a lot that did not actually have an available spot.

Table~\ref{table-accuracy} shows data from simulations run on several
different lot types and while varying simulation parameters including the
monitored fraction $f_m$ and estimation error in the monitored fraction. At
regular timesteps we query PocketParker and ask it to order the two lots
lot~1 and lot~2. We then compare its ordering with the ground truth available
through the simulator. In the case that two lots have probabilities within
$0.01$ of each other, PocketParker considers this a tie and suggests the more
preferable lot first.

Several trends can be observed in the results. First, overall PocketParker
does well on most lot types. The High Churn lot presents the greatest
difficulty, which we would expect since its large number of incoming and
outgoing drivers make prediction difficult. We are also concerned that the
High Churn errors are exclusively waste, indicating that PocketParker is
consistently sending drivers to the wrong lot, probably because it is
predicting that spots are available longer than they actually are. Clearly
more work is needed to determine the right approach for High Churn lots.

Excluding the High Churn lot, the lowest correct percentage with a $f_m >
0.1$ is 75\% for the Slow Fill lot, and accuracy is good throughout. The Low
Churn lot has a small number of errors but this is because both lots are
usually empty. Its error breakdown is similar to the High Churn lot, which
suggests it is something about regular departures and arrivals that is
causing PocketParker to be too optimistic about availability in the more
desirable lot.

Note, however, that this uniform query pattern is the most challenging for
PocketParker and so these results may be seen as a lower bound. This is
because PocketParker has the most information about lot availability during
active periods of arrival and departure events. Once it stops receiving
information, uncertainty grows. So to the degree that PocketParker queries
follow at least to some degree the pattern of arrivals and departures, we
will have fresh data and do well.

\subsection{Deployment}

\begin{figure*}
\centering
\includegraphics[width=\textwidth]{./figures/EventsOnThreeParkingLot.pdf}

\caption{\textbf{Map showing 217~parking events detected by PocketParker
during our forty-five-day deployment in three key lots.}  These were
generated by 26 participants.  Lot~A is considered the most desirable of the
three lots, a fact reflected in the higher event density of this lot.  
Lots~A~and~B were monitored by cameras to establish ground truth}

\label{fig-events}
\end{figure*}

Finally, to establish the accuracy of PocketParker we performed a pair of
deployments on our university campus.  The system structure was the same in
both cases:  The only infrastructure required was the PocketParker server for
receiving events and generating availability estimates.

For the first rollout, we installed the PocketParker client on the Android
version 4.1 system and the Samsung Nexus~S~4G smartphone.  In this
experiment, we configured PocketParker to operate in the background and to
require no user interaction.   We recruited five participants who generated
372 events over ten days---202 arrivals and 170 departures.  The deployment
period included several days when participants did not come to campus.  Most
parking events were generated by three participants who came to campus
frequently.  No participants complained of excessive energy usage or battery
life degradation.

In our second rollout, we deployed PocketParker on the Android version 4.2
system and Galaxy Nexus smartphone.  PocketParker, rather than running in the
background, displayed to users a campus map showing recent parking events.
The userbase involved 105 total participants, 102 of whom were members of
PhoneLab, an existing campus mobile phone network.  Over 45 days of
monitoring, they generated 10,827 events -- 5916 arrivals and 4911 departures
-- for an average of 241 per day.  Our main and medical campuses produced 3645
and 846 total events respectively, with non-campus locales contributing the
remaining 6336 events.

Figure~\ref{fig-events} shows all of the events that occurred in three key
lots that we monitored in the second experiment. Our computer science
building is labeled as the point of interest (POI). To determine ground
truth availability, we positioned four cameras at locations within the
building to monitor lots A~and~B in Figure~\ref{fig-events}.  Despite the fact
that many parking events took place in lot~C, we were unable to locate a
suitable unobstructed vantage point to gather camera data for that lot.
Nexus~S~4G smartphones equipped with fish-eye lenses served as our cameras.
Each took time lapse images at 1~Hz, time-stamped them using NTP and uploaded
them to a central server. Figure~\ref{fig-camera} shows two of our cameras
and a view of one of the monitored parking lots. A total of XXXXX images
were collected for the two monitored lots over two weeks.

To measure capacity, we hand-coded four days' worth of images for two lots on
a ten-point scale at ten-minute intervals. We were particularly interested
in the transition between empty and full states, so we were careful to ensure
that the lot was never marked completely full if there was a single available
spot visible. Because we collected a relatively small number of parking events
in camera-monitored lots A~and~B during our first deployment, we merged all
events into a single day before feeding the events into the PocketParker
estimation engine.
!!!ARE THE DETAILS IN THE ABOVE PARAGRAPH CORRECT?  (ONE DAY; :10 INTERVALS ETC.)

(1)  NEED UPDATED NUMBER OF PHOTOS FOR GROUND TRUTH (FROM DEPLOYMENT 2)

(2)  TAEYEON WORKING ON UPDATED DATA FOR TABLE 2 -- FROM DEPLOYMENT 2
HOLD UNTIL RECEIPT OF DATA...  ESP. "CAMPUS" DATA (FIRST FEW ROWS)

Table~\ref{table-accuracy} also includes numbers for our campus deployment
labeled as ``Campus''. Because we do not know the monitored fraction, we
experiment with several different values. Overall the accuracy of
PocketParker is excellent, even achieving 100\% accuracy at a monitored
driver fraction of 0.2. We believe this is because the more preferable
monitored lot has a very predictable availability pattern, filling rapidly
and staying full during business hours.


\begin{figure}[t]
\centering
\includegraphics[width=3.0in]{./figures/Camera_setting.pdf}

\caption{\textbf{Monitoring cameras.} A view of one of the monitored parking
lots is shown.}

\label{fig-camera}
\end{figure}
